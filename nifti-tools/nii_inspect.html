<html><head>
<style type="text/css">
table.main {
  position: relative;
  border: 1px solid white;
}
  
div.overlay {
  position: relative;
  width: 100px;
  overflow: hidden;
}
td.negdim {
  text-align: right;
}
img.lr {
  position: absolute;
  left: 0px;
  width: 100px;
}
img.i0 { opacity: 1 }
img.i1 { opacity: 1 }
img.i2 { opacity: 1 }
img.i3 { opacity: 1 }
img.i4 { opacity: 1 }
img.i5 { opacity: 1 }
img.i6 { opacity: 1 }
img.i7 { opacity: 1 }
img.i8 { opacity: 1 }
img.i9 { opacity: 1 }
</style>
<script type="text/javascript">
function getParameterByName(name) {
  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
  var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
  var results = regex.exec(location.search);
  return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

function onload() {
  var SliceDirs = [['Left','Right'],['Posterior','Anterior'],['Inferior','Superior']];
  // NEXT LINE USED IN REPLACEMENT OPERATION
  var defaultLayers = [];
  var layers = defaultLayers;
  for (var i=0; i<10; i++) {
    var lr = getParameterByName('layer'+i);
    if (lr) {
      var parts = lr.split('.');
      var ext = parts.pop();
      lr = parts.join('.');
      var title = getParameterByName('title'+i);
      layers[i] = {
        "name": lr,
        "ext":ext,
        "title":title
      }
    }
  }
  //var lr0 = getParameterByName('layer0');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!lr1) lr1 = '' $*/
  //lr1 = lr1.split('.');
  //ext1 = lr1.pop();
  //lr1 = lr1.join('.');
  //ti1 = getParameterByName('title1');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!ti1) ti1 = 'layer1' $*/
  //if (ti1) document.getElementById('title1').innerHTML = ti1
  //var lr2 = getParameterByName('layer2');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!lr2) lr2 = '' $*/
  //if (lr2) {
  //  lr2 = lr2.split('.');
  //  ext2 = lr2.pop();
  //  lr2 = lr2.join('.');
  //  ti2 = getParameterByName('title2');
  //  // NEXT LINE USED IN REPLACEMENT OPERATION
  //  /*$ if (!ti2) ti2 = 'layer2' $*/
  //  if (ti2) document.getElementById('title2').innerHTML = ti2
  //}
  //var lr3 = getParameterByName('layer3');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!lr3) lr3 = '' $*/
  //if (lr3) {
  //  lr3 = lr3.split('.');
  //  ext3 = lr3.pop();
  //  lr3 = lr3.join('.');
  //  ti3 = getParameterByName('title3');
  //  // NEXT LINE USED IN REPLACEMENT OPERATION
  //  /*$ if (!ti3) ti3 = 'layer3' $*/
  //  if (ti3) document.getElementById('title 3').innerHTML = ti3
  //}
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!bins) bins = 0 $*/
  
  // NEXT LINE USED IN REPLACEMENT OPERATION
  var defaultSliceRange = [];
  var sliceRange = defaultSliceRange;
  var dims = ['x','y','z']
  for (var d=0; d<3; d++) {
    s = getParameterByName('slices_'+dims[d]);
    if (s) {
      sliceRange[d] = s.split(':');
    }
  }
  //var slicesX = getParameterByName('slices_x');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!slicesX) slicesX = '0:1:2' $*/
  //var slicesY = getParameterByName('slices_y');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!slicesY) slicesY = '0:1:2' $*/
  //var slicesZ = getParameterByName('slices_z');
  // NEXT LINE USED IN REPLACEMENT OPERATION
  /*$ if (!slicesZ) slicesZ = '0:1:2' $*/
  
  //var slices = [
  //  slicesX.split(':'),
  //  slicesY.split(':'),
  //  slicesZ.split(':')
  //]
  for (var d in sliceRange) {
    for (var i in sliceRange[d]) sliceRange[d][i] = parseInt(sliceRange[d][i]);
  }
      
  var ans = '';
  for (var d in dims) {
    var T = '<table class="main"><tr>';
    T += '<td class="negdim"><div class="overlay">'+SliceDirs[d][0]+'</div></td>';
    var dim = dims[d];
    for (var s=sliceRange[d][0]; s<=sliceRange[d][2]; s+=sliceRange[d][1]) {
      var pngFile = layers[0].name+'_'+dim+s+'.'+layers[0].ext1;
      T += '<td><div class="overlay">';
      T += '<img class="lr" src="'+pngFile+'"/>';
      for (i = 0; i<layers.length; i++) {
        lr = layers[i];
        if (lr.name) {
          var pngFile = lr.name+'_'+dim+s+'.'+lr.ext;
          var style = (i==0 ? ' style="position:relative"' : '');
          T += '<img class="lr i'+i+'"'+style+' src="'+pngFile+'"/>';
        }
      }
      T += '</div></td>';
    }
    T += '<td class="posdim"><div class="overlay">'+SliceDirs[d][1]+'</div></td>';
    T += '</tr><tr>';
    for (var s=sliceRange[d][0]; s<sliceRange[d][2]; s+=sliceRange[d][1]) {
      T += '<td>'+s+'</td>';     
    }
    T += '</tr></table>';
    ans += T;
  }
  document.getElementById('MAIN').innerHTML = ans
  var controls = [];
  for (i = 0; i<layers.length; i++) {
    lr = layers[i];
    if (lr.name) {
      var title = lr.title? lr.title : lr.name;
      controls.push('<div>Layer '+i+'<select type="select" size="1" onchange="applyOpacity(this.options[this.selectedIndex].value,'+i+')"><option value="0">Hidden</option><option value="0.5">50% visible</option><option selected value="1">100% visible</option></select>&nbsp;<span>'+title+'</span></div>');
    }
  }
  document.getElementById('controls').innerHTML = controls.join('');
}

// http://www.hunlock.com/blogs/Totally_Pwn_CSS_with_Javascript
function getCSSRule(ruleName, deleteFlag) {               // Return requested style obejct
   ruleName=ruleName.toLowerCase();                       // Convert test string to lower case.
   if (document.styleSheets) {                            // If browser can play with stylesheets
      for (var i=0; i<document.styleSheets.length; i++) { // For each stylesheet
         var styleSheet=document.styleSheets[i];          // Get the current Stylesheet
         var ii=0;                                        // Initialize subCounter.
         var cssRule=false;                               // Initialize cssRule. 
         do {                                             // For each rule in stylesheet
            if (styleSheet.cssRules) {                    // Browser uses cssRules?
               cssRule = styleSheet.cssRules[ii];         // Yes --Mozilla Style
            } else {                                      // Browser usses rules?
               cssRule = styleSheet.rules[ii];            // Yes IE style. 
            }                                             // End IE check.
            if (cssRule)  {                               // If we found a rule...
               if (cssRule.selectorText.toLowerCase()==ruleName) { //  match ruleName?
                 return cssRule;                          // return the style object.
               }                                          // End found rule name
            }                                             // end found cssRule
            ii++;                                         // Increment sub-counter
         } while (cssRule)                                // end While loop
      }                                                   // end For loop
   }                                                      // end styleSheet ability check
   return false;                                          // we found NOTHING!
}                                                         // end getCSSRule 

function applyOpacity(val,i) {
  var rule = getCSSRule('img.i'+i)
  if (rule) rule.style.opacity = val;
}
</script>
</head>
<body onload="onload()">
<div id="controls"></div>
<div id="MAIN"></div>
</body>
</html>
  
